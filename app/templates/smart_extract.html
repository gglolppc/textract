{% extends "base.html" %}
{% block title %}Smart Extract â€” textract.me{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-10 space-y-8">

  <!-- HEADER -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-50 text-purple-700 text-xs font-semibold mb-3">
        <span class="w-2 h-2 rounded-full bg-purple-500 animate-pulse"></span>
        <span>Smart Extract</span>
        <span class="text-[10px] uppercase tracking-wide bg-purple-100 px-2 py-0.5 rounded-full">PRO</span>
      </div>
      <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-gray-900">
        Turn document photos into clean tables
      </h1>
      <p class="mt-2 text-sm md:text-base text-gray-500 max-w-2xl">
        Upload up to 10 images with receipts, price lists or estimates â€” weâ€™ll extract a structured table you can edit and export to Excel or PDF.
      </p>
    </div>
    <div class="md:text-right text-sm text-gray-500">
      <p class="font-medium text-gray-700">Daily limits</p>
      <p class="text-xs">
        Free: 1 Smart Extract / day<br>
        PRO: unlimited extracts, Excel &amp; PDF export
      </p>
    </div>
  </div>

  <!-- MINI GUIDE -->
  <div class="max-w-3xl mx-auto">
    <div class="flex flex-wrap justify-center gap-3 text-xs md:text-sm font-medium bg-gray-50 border border-gray-100 rounded-2xl px-4 md:px-6 py-3 shadow-sm">
      <div class="flex items-center gap-2">
        <span class="text-purple-500 text-base">â‘ </span>
        <span>Upload photos</span>
      </div>
      <span class="hidden md:inline text-gray-300">â†’</span>
      <div class="flex items-center gap-2">
        <span class="text-purple-500 text-base">â‘¡</span>
        <span>AI extracts table</span>
      </div>
      <span class="hidden md:inline text-gray-300">â†’</span>
      <div class="flex items-center gap-2">
        <span class="text-purple-500 text-base">â‘¢</span>
        <span>Edit cells</span>
      </div>
      <span class="hidden md:inline text-gray-300">â†’</span>
      <div class="flex items-center gap-2">
        <span class="text-purple-500 text-base">â‘£</span>
        <span>Save / Export</span>
      </div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-start">

    <!-- LEFT: UPLOAD -->
    <div class="space-y-4">

      <!-- Upload card -->
      <div
        id="dropzone"
        class="group relative flex flex-col items-center justify-center gap-3 px-6 py-10 border-2 border-dashed rounded-3xl bg-white shadow-sm hover:shadow-md transition cursor-pointer border-gray-200 hover:border-purple-400"
      >
        <div class="flex flex-col items-center text-center">
          <div
            class="flex items-center justify-center w-12 h-12 rounded-2xl bg-purple-50 text-purple-600 mb-2 group-hover:bg-purple-100"
          >
            <!-- Ð¸ÐºÐ¾Ð½ÐºÑƒ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸ÑˆÑŒ lucide -->
            <span class="text-2xl">ðŸ“„</span>
          </div>
          <p class="text-sm md:text-base font-semibold text-gray-800">
            Drag &amp; drop your files here
          </p>
          <p class="text-xs md:text-sm text-gray-500">
            or
            <span class="text-purple-600 font-medium">browse from device</span>
          </p>
          <p class="mt-2 text-[11px] text-gray-400">
            Up to 10 images â€¢ JPG/PNG â€¢ max 10 MB each
          </p>
        </div>

        <input
          id="fileInput"
          type="file"
          class="absolute inset-0 opacity-0 cursor-pointer"
          multiple
          accept="image/*"
        />
      </div>

      <!-- Uploaded files grid -->
      <div class="bg-white border border-gray-100 rounded-2xl p-4 shadow-sm">
        <div class="flex items-center justify-between mb-3">
          <p class="text-sm font-semibold text-gray-800">
            Uploaded files
          </p>
          <p class="text-xs text-gray-400">
            <span id="fileCount">0</span> / 10
          </p>
        </div>
        <div
          id="filesGrid"
          class="grid grid-cols-3 sm:grid-cols-4 gap-3 min-h-[72px]"
        >
          <!-- JS Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿Ñ€ÐµÐ²ÑŒÑŽÑˆÐºÐ¸.
               ÐŸÐ¾ÐºÐ° Ð¿ÑƒÑÑ‚Ð¾Ð¹ state: -->
          <div
            id="filesEmptyState"
            class="col-span-3 sm:col-span-4 flex items-center justify-center text-[11px] text-gray-400 py-4"
          >
            No files yet. Drop images above or click to upload.
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT: OPTIONS / ACTION -->
    <div class="space-y-4">

      <!-- Table options -->
      <div class="bg-white border border-gray-100 rounded-2xl p-5 shadow-sm">
        <div class="flex items-center justify-between mb-3">
          <p class="text-sm font-semibold text-gray-800">
            Table type (optional)
          </p>
          <span class="text-[11px] text-gray-400">You can change later</span>
        </div>

        <div class="grid grid-cols-2 gap-2 text-xs">
          <button
            type="button"
            data-mode="simple"
            class="table-mode-btn inline-flex items-center justify-center px-3 py-2 rounded-xl border border-purple-500 bg-purple-50 text-purple-700 font-medium text-xs md:text-sm"
          >
            Simple table
            <span class="ml-1 text-[10px] text-purple-500">(default)</span>
          </button>

          <button
            type="button"
            data-mode="receipt"
            class="table-mode-btn inline-flex items-center justify-center px-3 py-2 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 text-xs md:text-sm hover:border-purple-400 hover:bg-purple-50 hover:text-purple-700 transition"
          >
            Receipt / bill
          </button>

          <button
            type="button"
            data-mode="price_list"
            class="table-mode-btn inline-flex items-center justify-center px-3 py-2 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 text-xs md:text-sm hover:border-purple-400 hover:bg-purple-50 hover:text-purple-700 transition"
          >
            Price list
          </button>

          <button
            type="button"
            data-mode="auto"
            class="table-mode-btn inline-flex items-center justify-center px-3 py-2 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 text-xs md:text-sm hover:border-purple-400 hover:bg-purple-50 hover:text-purple-700 transition"
          >
            Auto-detect
          </button>
        </div>
      </div>

      <!-- Info / limits -->
      <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-100 rounded-2xl p-4 text-xs text-gray-700 flex flex-col gap-2">
        <div class="flex items-center gap-2">
          <span class="text-purple-500 text-base">âš¡</span>
          <p class="font-semibold">Best results tips</p>
        </div>
        <ul class="list-disc list-inside text-[11px] space-y-1 text-gray-600">
          <li>Make sure text is readable and in focus.</li>
          <li>Try to keep one receipt / table per photo.</li>
          <li>For mixed languages, choose a clear table type.</li>
        </ul>
      </div>

      <!-- Extract button + status -->
      <div class="bg-white border border-gray-100 rounded-2xl p-5 shadow-sm space-y-3">
        <button
          id="extractBtn"
          type="button"
          class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl bg-purple-600 hover:bg-purple-700 text-white text-sm md:text-base font-semibold shadow-md disabled:opacity-60 disabled:cursor-not-allowed transition"
        >
          <span>Extract table</span>
          <span id="extractSpinner" class="hidden text-xs">â€¦</span>
        </button>
        <p class="text-[11px] text-gray-400">
          Estimated time: <span class="font-medium text-gray-500">2â€“3 minutes</span> for 5â€“10 photos.
          Result link will appear below or in your
          <a href="/account/history" class="text-purple-600 hover:underline">history</a>.
        </p>
        <p id="statusMessage" class="text-xs text-gray-500"></p>
      </div>

    </div>
  </div>

  <!-- RESULT SECTION -->
  <div
    id="resultSection"
    class="mt-6 hidden space-y-4"
  >
    <div class="flex items-center justify-between gap-2">
      <div>
        <p class="text-sm font-semibold text-gray-800">
          Extracted table
        </p>
        <p class="text-[11px] text-gray-400">
          You can edit cells before saving or exporting.
        </p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button
          id="copyJsonBtn"
          type="button"
          class="hidden md:inline-flex items-center gap-1 px-3 py-1.5 rounded-xl border border-gray-200 text-xs text-gray-700 hover:border-purple-400 hover:text-purple-700 bg-white transition"
        >
          Copy JSON
          <span class="text-[10px] text-purple-500">PRO</span>
        </button>
        <button
          id="exportExcelBtn"
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl border border-gray-200 text-xs text-gray-700 hover:border-purple-400 hover:text-purple-700 bg-white transition"
        >
          Export Excel
        </button>
        <button
          id="exportPdfBtn"
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl border border-gray-200 text-xs text-gray-700 hover:border-purple-400 hover:text-purple-700 bg-white transition"
        >
          Export PDF
        </button>
        <button
          id="saveTableBtn"
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl bg-purple-600 text-white text-xs font-semibold rounded-xl hover:bg-purple-700 shadow-sm transition"
        >
          Save to history
        </button>
      </div>
    </div>

    <div class="bg-white border border-gray-100 rounded-2xl p-4 md:p-5 shadow-sm overflow-x-auto">
      <!-- ÑÑŽÐ´Ð° Tabulator Ð¸Ð»Ð¸ ÑÐ²Ð¾Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° -->
      <div id="tableContainer" class="min-h-[240px] text-sm text-gray-800">
        <!-- JS Ð¾Ñ‚Ñ€Ð¸ÑÑƒÐµÑ‚ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ -->
      </div>
    </div>
  </div>

</div>

{% block extra_scripts %}
<script src="/static/js/smart_extract.js"></script>
{% endblock %}

{% endblock %}
