{% extends "base.html" %}
{% block title %}Text to Speech â€” textract.me{% endblock %}

{% block content %}
<!-- MINI GUIDE -->
<div class="max-w-4xl mx-auto text-center mb-8">
  <div class="inline-flex flex-wrap justify-center gap-4 text-gray-700 text-sm md:text-base font-medium bg-gray-50 border rounded-2xl px-6 py-3 shadow-sm">
    <div class="flex items-center gap-2">ğŸ“ <span>Write or paste your text</span></div>
    <span class="hidden md:inline text-gray-400">â†’</span>
    <div class="flex items-center gap-2">ğŸ™ï¸ <span>Select a voice</span></div>
    <span class="hidden md:inline text-gray-400">â†’</span>
    <div class="flex items-center gap-2">â–¶ï¸ <span>Press â€œGenerateâ€</span></div>
    <span class="hidden md:inline text-gray-400">â†’</span>
    <div class="flex items-center gap-2">â³ <span>Wait for the result</span></div>
  </div>
</div>

<div class="relative max-w-6xl mx-auto mt-10 border rounded-2xl shadow-sm bg-white p-6">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 {% if not user %}pointer-events-none select-none{% endif %}">

    <!-- LEFT TEXT AREA -->
    <div class="md:col-span-2 flex flex-col">
      <div class="flex items-center justify-between mb-2">
        <label class="text-sm font-medium">Enter your text</label>
        <span id="charCount" class="text-sm text-gray-500" data-max="{{ plans[user.subscription]['max_char'] if user else 0 }}">
          0 / {{ plans[user.subscription]['max_char'] if user else 0 }}
        </span>
      </div>

      <textarea id="ttsText"
                class="w-full h-80 border rounded-xl p-4 focus:ring-2 focus:ring-purple-500 resize-none {% if not user %}bg-gray-50 text-gray-400{% endif %}"
                placeholder="{% if user %}Type something to convert to speech...{% else %}Login required to use text-to-speech...{% endif %}"
                {% if not user %}disabled{% endif %}></textarea>
    </div>

    <!-- RIGHT CONTROL PANEL -->
    <div class="flex flex-col justify-start items-stretch bg-gray-50 border rounded-xl shadow-inner p-6">
      <div class="w-full space-y-4">

        <!-- Voice row -->
     <div class="flex items-center justify-between">
      <label class="text-sm font-medium">Voice:</label>
      <div class="flex items-center gap-2 flex-1 ml-3">
        <select id="voiceSelect"
                class="border rounded-lg px-3 py-1 focus:ring-2 focus:ring-purple-500 flex-1 {% if not user %}bg-gray-100 text-gray-500{% endif %}"
                {% if not user %}disabled{% endif %}>
          {% if user %}
           {% for key, label in voices.items() %}
              <option value="{{key}}" title="{{label}}">{{label.split('â€”')[0].strip()}}</option>
            {% endfor %}
          {% else %}
            <option>Disabled</option>
          {% endif %}
        </select>

        <!-- preview button -->
    <button id="previewBtn"
            class="flex items-center justify-center w-9 h-9 rounded-full border text-purple-600 hover:bg-purple-50 shadow-sm
                   transition text-sm shrink-0
                   {% if not user %}cursor-not-allowed text-gray-400{% endif %}"
            title="Preview voice"
            {% if not user %}disabled{% endif %}>
      â–¶ï¸
    </button>
      </div>
    </div>

        <!-- Duration row -->
        <div class="flex items-center justify-between">
          <label class="text-sm font-medium">Will take about:</label>
          <div id="durationDisplay"
               class="rounded-lg px-4 py-1 text-gray-700 font-semibold ml-3 flex-1 text-right">
            0:00
          </div> minutes.
        </div>

        <!-- Generate button -->
        <button id="generateBtn"
                class="w-full font-semibold py-3 rounded-lg shadow transition
                       {% if user %}
                         bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 text-white
                       {% else %}
                         bg-gray-300 text-gray-500 cursor-not-allowed
                       {% endif %}"
                {% if not user %}disabled{% endif %}>
          {% if user %}ğŸ§ Generate{% else %}ğŸ”’ Generate (Login to use){% endif %}
        </button>

        <!-- Divider -->
        <div class="border-t border-gray-300 my-4"></div>

        <!-- RESULT BLOCK -->
        <div class="text-center">
          <h3 class="text-lg font-semibold mb-3 text-gray-800">Result</h3>
          <div id="statusText" class="text-sm text-gray-500 mb-4"></div>
          <audio id="audioPlayer" controls class="w-full hidden"></audio>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay for guests -->
  {% if not user %}
  <div class="absolute inset-0 bg-white/40 backdrop-blur-[2px] flex flex-col justify-center items-center text-center px-6">
    <div class="bg-white/90 border rounded-2xl p-6 shadow-md max-w-md">
      <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-2">
        ğŸ” Text-to-Speech is available for registered users
      </h3>
      <p class="text-gray-600 mb-5">Sign up or log in to start generating realistic voices from your text.</p>
      <a href="/auth/register"
         class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white font-semibold px-6 py-3 rounded-xl shadow hover:from-purple-700 hover:to-indigo-800 transition">
        Log in or Sign up
      </a>
    </div>
  </div>
  {% endif %}
</div>

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-1/3 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center space-y-3"></div>
{% endblock %}

{% if user %}
{% block extra_scripts %}
<script>

  window.appConfig = {
    maxChars: {{ plans[user.subscription]['max_char'] | tojson if user else 0 }}
  };
</script>
<script src="{{ url_for('static', path='js/tts_preview.js') }}"></script>
<script src="{{ url_for('static', path='js/tts.js') }}"></script>
{% endblock %}
{% endif %}
